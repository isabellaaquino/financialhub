{"ast":null,"code":"var _jsxFileName = \"D:\\\\Workspace\\\\financialhub\\\\frontend\\\\src\\\\context\\\\AuthContext.tsx\",\n  _s = $RefreshSig$();\nimport { createContext, useEffect, useState } from \"react\";\nimport authService from \"../api/services/AuthService\";\nimport jwt_decode from \"jwt-decode\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext({});\nexport const AuthProvider = _ref => {\n  _s();\n  let {\n    children\n  } = _ref;\n  let [loading, setLoading] = useState(true);\n  let [authTokens, setAuthTokens] = useState(() => localStorage.getItem(\"authTokens\") ? JSON.parse(localStorage.getItem(\"authTokens\")) : null);\n  let [loggedUser, setLoggedUser] = useState(() => localStorage.getItem(\"authTokens\") ? jwt_decode(localStorage.getItem(\"authTokens\")) : null);\n  async function SignIn(email, password) {\n    const response = await authService.signIn(email, password);\n    setAuthTokens(response);\n    setLoggedUser(jwt_decode(response.access));\n    localStorage.setItem(\"authTokens\", JSON.stringify(response));\n  }\n  function SignOut() {\n    setAuthTokens(null);\n    setLoggedUser(null);\n    localStorage.removeItem(\"authTokens\");\n  }\n  async function RefreshToken() {\n    if (authTokens) {\n      const response = await authService.refreshToken(authTokens.refresh);\n      setAuthTokens(response);\n      setLoggedUser(jwt_decode(response.access));\n      localStorage.setItem(\"authTokens\", JSON.stringify(response));\n    } else {\n      SignOut();\n    }\n  }\n  useEffect(() => {\n    let interval = setInterval(() => {\n      if (authTokens) RefreshToken();\n    }, 60000 * 5); //5 minutes\n    return () => clearInterval(interval);\n  }, [authTokens, loading]);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user: loggedUser,\n      isAuthenticated: Boolean(loggedUser),\n      SignIn,\n      SignOut\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"3Surf6PDo/z939tW2qAQv57NKq4=\");\n_c = AuthProvider;\nexport default AuthContext;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useEffect","useState","authService","jwt_decode","AuthContext","AuthProvider","children","loading","setLoading","authTokens","setAuthTokens","localStorage","getItem","JSON","parse","loggedUser","setLoggedUser","SignIn","email","password","response","signIn","access","setItem","stringify","SignOut","removeItem","RefreshToken","refreshToken","refresh","interval","setInterval","clearInterval","user","isAuthenticated","Boolean"],"sources":["D:/Workspace/financialhub/frontend/src/context/AuthContext.tsx"],"sourcesContent":["import { createContext, useEffect, useState } from \"react\";\r\nimport { api } from \"../api/services/Api\";\r\nimport authService from \"../api/services/AuthService\";\r\nimport { User } from \"../models/User\";\r\n\r\nimport jwt_decode from \"jwt-decode\";\r\nimport { useNavigate } from \"react-router-dom\";\r\ninterface AuthContextData {\r\n  user: User | null;\r\n  SignIn(email: string, password: string): void;\r\n  SignOut(): void;\r\n  isAuthenticated: boolean;\r\n}\r\n\r\ninterface Props {\r\n  children: React.ReactNode;\r\n}\r\n\r\ninterface AuthTokens {\r\n  access: string;\r\n  refresh: string;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextData>({} as AuthContextData);\r\nexport const AuthProvider = ({ children }: Props) => {\r\n  let [loading, setLoading] = useState(true);\r\n  let [authTokens, setAuthTokens] = useState<AuthTokens | null>(() =>\r\n    localStorage.getItem(\"authTokens\")\r\n      ? JSON.parse(localStorage.getItem(\"authTokens\")!)\r\n      : null\r\n  );\r\n  let [loggedUser, setLoggedUser] = useState<User | null>(() =>\r\n    localStorage.getItem(\"authTokens\")\r\n      ? jwt_decode(localStorage.getItem(\"authTokens\")!)\r\n      : null\r\n  );\r\n\r\n  async function SignIn(email: string, password: string) {\r\n    const response = (await authService.signIn(email, password)) as AuthTokens;\r\n    setAuthTokens(response);\r\n    setLoggedUser(jwt_decode(response.access));\r\n    localStorage.setItem(\"authTokens\", JSON.stringify(response));\r\n  }\r\n\r\n  function SignOut() {\r\n    setAuthTokens(null);\r\n    setLoggedUser(null);\r\n    localStorage.removeItem(\"authTokens\");\r\n  }\r\n\r\n  async function RefreshToken() {\r\n    if (authTokens) {\r\n      const response = (await authService.refreshToken(\r\n        authTokens.refresh\r\n      )) as AuthTokens;\r\n      setAuthTokens(response);\r\n      setLoggedUser(jwt_decode(response.access));\r\n      localStorage.setItem(\"authTokens\", JSON.stringify(response));\r\n    } else {\r\n      SignOut();\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    let interval = setInterval(() => {\r\n      if (authTokens) RefreshToken();\r\n    }, 60000*5); //5 minutes\r\n    return () => clearInterval(interval);\r\n  }, [authTokens, loading]);\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user: loggedUser,\r\n        isAuthenticated: Boolean(loggedUser),\r\n        SignIn,\r\n        SignOut,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\nexport default AuthContext;\r\n"],"mappings":";;AAAA,SAASA,aAAa,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAE1D,OAAOC,WAAW,MAAM,6BAA6B;AAGrD,OAAOC,UAAU,MAAM,YAAY;AAAC;AAkBpC,MAAMC,WAAW,gBAAGL,aAAa,CAAkB,CAAC,CAAC,CAAoB;AACzE,OAAO,MAAMM,YAAY,GAAG,QAAyB;EAAA;EAAA,IAAxB;IAAEC;EAAgB,CAAC;EAC9C,IAAI,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGP,QAAQ,CAAC,IAAI,CAAC;EAC1C,IAAI,CAACQ,UAAU,EAAEC,aAAa,CAAC,GAAGT,QAAQ,CAAoB,MAC5DU,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,GAC9BC,IAAI,CAACC,KAAK,CAACH,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,CAAE,GAC/C,IAAI,CACT;EACD,IAAI,CAACG,UAAU,EAAEC,aAAa,CAAC,GAAGf,QAAQ,CAAc,MACtDU,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,GAC9BT,UAAU,CAACQ,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,CAAE,GAC/C,IAAI,CACT;EAED,eAAeK,MAAM,CAACC,KAAa,EAAEC,QAAgB,EAAE;IACrD,MAAMC,QAAQ,GAAI,MAAMlB,WAAW,CAACmB,MAAM,CAACH,KAAK,EAAEC,QAAQ,CAAgB;IAC1ET,aAAa,CAACU,QAAQ,CAAC;IACvBJ,aAAa,CAACb,UAAU,CAACiB,QAAQ,CAACE,MAAM,CAAC,CAAC;IAC1CX,YAAY,CAACY,OAAO,CAAC,YAAY,EAAEV,IAAI,CAACW,SAAS,CAACJ,QAAQ,CAAC,CAAC;EAC9D;EAEA,SAASK,OAAO,GAAG;IACjBf,aAAa,CAAC,IAAI,CAAC;IACnBM,aAAa,CAAC,IAAI,CAAC;IACnBL,YAAY,CAACe,UAAU,CAAC,YAAY,CAAC;EACvC;EAEA,eAAeC,YAAY,GAAG;IAC5B,IAAIlB,UAAU,EAAE;MACd,MAAMW,QAAQ,GAAI,MAAMlB,WAAW,CAAC0B,YAAY,CAC9CnB,UAAU,CAACoB,OAAO,CACJ;MAChBnB,aAAa,CAACU,QAAQ,CAAC;MACvBJ,aAAa,CAACb,UAAU,CAACiB,QAAQ,CAACE,MAAM,CAAC,CAAC;MAC1CX,YAAY,CAACY,OAAO,CAAC,YAAY,EAAEV,IAAI,CAACW,SAAS,CAACJ,QAAQ,CAAC,CAAC;IAC9D,CAAC,MAAM;MACLK,OAAO,EAAE;IACX;EACF;EAEAzB,SAAS,CAAC,MAAM;IACd,IAAI8B,QAAQ,GAAGC,WAAW,CAAC,MAAM;MAC/B,IAAItB,UAAU,EAAEkB,YAAY,EAAE;IAChC,CAAC,EAAE,KAAK,GAAC,CAAC,CAAC,CAAC,CAAC;IACb,OAAO,MAAMK,aAAa,CAACF,QAAQ,CAAC;EACtC,CAAC,EAAE,CAACrB,UAAU,EAAEF,OAAO,CAAC,CAAC;EAEzB,oBACE,QAAC,WAAW,CAAC,QAAQ;IACnB,KAAK,EAAE;MACL0B,IAAI,EAAElB,UAAU;MAChBmB,eAAe,EAAEC,OAAO,CAACpB,UAAU,CAAC;MACpCE,MAAM;MACNQ;IACF,CAAE;IAAA,UAEDnB;EAAQ;IAAA;IAAA;IAAA;EAAA,QACY;AAE3B,CAAC;AAAC,GA1DWD,YAAY;AAAA,KAAZA,YAAY;AA2DzB,eAAeD,WAAW;AAAC;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}